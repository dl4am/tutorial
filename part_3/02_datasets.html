
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Datasets for automix systems &#8212; Deep Learning for Automatic Mixing</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Models" href="03_models.html" />
    <link rel="prev" title="Inference" href="01_inference.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Deep Learning for Automatic Mixing</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../landing-page.html">
                    Deep Learning for Automatic Mixing 
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Audio Engineering
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../part_1/01_audio-effects.html">
   Audio Effects
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../part_1/02_music-production.html">
   Music Production
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_1/music-production/01_mixing.html">
     Mixing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_1/music-production/02_equalization.html">
     Equalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_1/music-production/03_reveberation.html">
     Reverberation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_1/music-production/04_compression.html">
     Compression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_1/music-production/05_aesthetics.html">
     Aesthetics
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Automatic Mixing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../part_2/01_imp.html">
   Intelligent Music Production
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../part_2/02_problem.html">
   Problem Formulation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../part_2/03_methods.html">
   Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_2/methods/01_mixwaveunet.html">
     Mix-Wave-U-Net
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../part_2/methods/02_dmc.html">
     Differentiable Mixing Console
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../part_2/04_loss-functions.html">
   Loss Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../part_2/05_diffsp.html">
   Differentiable signal processing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Implementation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_inference.html">
   Inference
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Datasets for automix systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_models.html">
   Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_training.html">
   Training
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Evaluation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../part_4/01_metrics.html">
   Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../part_4/05_evaluate.html">
   Evaluation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Conclusion
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../part_5/01_future-directions.html">
   Future Directions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../part_5/02_conclusion.html">
   Conclusions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../part_5/03_references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/part_3/02_datasets.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/docs/part_3/02_datasets.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fpart_3/02_datasets.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/part_3/02_datasets.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Datasets for automix systems
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#listed-below-are-few-of-the-advised-variables-that-you-should-define-in-the-dataset-class-definition">
     Listed below are few of the advised variables that you should define in the dataset class definition:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-processing-advice-for-loading-multitrack-data">
     Pre-processing advice for loading multitrack data:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enst-drums">
     ENST Drums
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dsd100-dataset">
     DSD100 dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#medleydb-dataset">
   MedleyDB Dataset
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Datasets for automix systems</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Datasets for automix systems
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#listed-below-are-few-of-the-advised-variables-that-you-should-define-in-the-dataset-class-definition">
     Listed below are few of the advised variables that you should define in the dataset class definition:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-processing-advice-for-loading-multitrack-data">
     Pre-processing advice for loading multitrack data:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enst-drums">
     ENST Drums
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dsd100-dataset">
     DSD100 dataset
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#medleydb-dataset">
   MedleyDB Dataset
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="datasets-for-automix-systems">
<h1>Datasets for automix systems<a class="headerlink" href="#datasets-for-automix-systems" title="Permalink to this headline">#</a></h1>
<p>In this notebook, we will first discuss the datasets used to train the automix systems. Thereafter, we will see how to pre-process the data and set up the dataloaders for training the deep learning models for these systems.</p>
<p>Training automix models requires paired multitrack stems and their corresponding mixdowns. Below listed are the desired properties for these datasets:</p>
<ol class="simple">
<li><p><strong>Time alligned stems and mixes</strong> : We require time-alligned stems and mixes to allow the models to learn timewise transformation relationships.</p></li>
<li><p><strong>Diverse instrument categories</strong> : The more diverse the number of instruments in the dataset, the more likely is the trained system to perform well with real-world songs.</p></li>
<li><p><strong>Diverse genres of songs</strong> : The mixing practices vary slightly from one genre to another. Hence, if the dataset has multitrack mixes from different genres, the trained system will be exposed to more diverse distribution of data.</p></li>
<li><p><strong>Dry multitrack stems</strong> : Mixing involves processing the recorded dry stems for corrective and aesthetic reasons before summing them to form a cohesive mixture. For a model to learn the correct way to process the stems to generate mixes, we need to train it on dry unprocessed stems and mix pairs. However, more recently approaches to use processed stems from datasets like MUSEDB to train automix systems have been explored. These approaches use a pre-processing effect normalisation method to deal with pre-processed wet stems. For the scope of this tutorial, we do not discuss these methods. However, we recommend having a look at <a class="reference external" href="https://arxiv.org/abs/2208.11428">this</a> paper being presented at ISMIR 2022.</p></li>
</ol>
<p>Here we list the datasets available for training automix systems.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Dataset</p></th>
<th class="head"><p>Size(Hrs)</p></th>
<th class="head"><p>no. of Songs</p></th>
<th class="head"><p>no. of Instrument Category</p></th>
<th class="head"><p>no. of tracks</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Usage Permissions</p></th>
<th class="head"><p>Other info</p></th>
<th class="head"><p>Remarks</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://medleydb.weebly.com/">MedleyDB</a></p></td>
<td><p>7.2</p></td>
<td><p>122</p></td>
<td><p>82</p></td>
<td><p>1-26</p></td>
<td><p>Multitrack, Wav</p></td>
<td><p>Open</p></td>
<td><p>44.1KHz, 16 bit, stereo</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://perso.telecom-paristech.fr/grichard/ENST-drums/">ENST Drums</a></p></td>
<td><p>1.25</p></td>
<td><p>-</p></td>
<td><p>1</p></td>
<td><p>8</p></td>
<td><p>Drums, Wav/AVI</p></td>
<td><p>Limited</p></td>
<td><p>44.1KHz, 16 bit, stereo</p></td>
<td><p>Drums only dataset</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.cambridge-mt.com/ms/mtk/">Cambridge Multitrack</a></p></td>
<td><p>&gt;3</p></td>
<td><p>&gt;50</p></td>
<td><p>&gt;5</p></td>
<td><p>5-70</p></td>
<td><p>Multitrack, Wav</p></td>
<td><p>open</p></td>
<td><p>44.1KHz, 16/24 bit, Stereo</p></td>
<td><p>Not time alligned, recordings for all the songs are not uniform</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://sigsep.github.io/datasets/musdb.html">MUSEDB</a></p></td>
<td><p>~10</p></td>
<td><p>150</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>Multitrack, Wav</p></td>
<td><p>open</p></td>
<td><p>44.1KHz, Stereo</p></td>
<td><p>used mainly for source separation, wet stems</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="http://www.slakh.com/">Slakh</a></p></td>
<td><p>145</p></td>
<td><p>2100</p></td>
<td><p>34</p></td>
<td><p>4-48</p></td>
<td><p>Synthesised, Flac,</p></td>
<td><p>open</p></td>
<td><p>44.1KHz, 16 bit, stereo</p></td>
<td><p>used mainly for source separation; sometimes wet stems</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://weathervanemusic.org/shakingthrough/episode-index">Shaking Through</a></p></td>
<td><p>4.5</p></td>
<td><p>68</p></td>
<td><p>&gt;30</p></td>
<td><p>&gt;40</p></td>
<td><p>Multitrack, Wav</p></td>
<td><p>User only</p></td>
<td><p>44.1/88.2KHz, 16/24 bit, stereo</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://bitmidi.com/">BitMIDI</a></p></td>
<td><p>-</p></td>
<td><p>&gt;1M</p></td>
<td><p>&gt;5</p></td>
<td><p>&gt;5</p></td>
<td><p>Multitrack MIDI</p></td>
<td><p>open</p></td>
<td><p>MIDI data</p></td>
<td><p>MIDI data submitted by users across world</p></td>
</tr>
</tbody>
</table>
<p>For this tutorial, we will use ENST-drums for training Wave-U-Net and ENST-drums, DSD100, and MedleyDB for training Differentiable Mixing Console(DMC).</p>
<p>In the following section, we will discuss the recommended pre-processing methods for these datasets and the methods to set up dataloaders for training the models. This notebook assumes that you have already installed the <code class="docutils literal notranslate"><span class="pre">automix</span></code> package.</p>
<p>We define dataset classes for DSD100, MedleyDB, and ENSTdrums, and then use <code class="docutils literal notranslate"><span class="pre">getitem()</span></code> function to load the audio data into the dataloader for training and testing.</p>
<section id="listed-below-are-few-of-the-advised-variables-that-you-should-define-in-the-dataset-class-definition">
<h2>Listed below are few of the advised variables that you should define in the dataset class definition:<a class="headerlink" href="#listed-below-are-few-of-the-advised-variables-that-you-should-define-in-the-dataset-class-definition" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p><strong>Root directory</strong> of the folder containing the dataset.</p></li>
<li><p><strong>Length of the audio</strong> you wish to load for training/testing.</p></li>
<li><p><strong>Sample rate</strong> at which you wish to load the audio data.</p></li>
</ol>
</section>
<section id="pre-processing-advice-for-loading-multitrack-data">
<h2>Pre-processing advice for loading multitrack data:<a class="headerlink" href="#pre-processing-advice-for-loading-multitrack-data" title="Permalink to this headline">#</a></h2>
<ol>
<li><p>Discard the examples from the dataset that have length shorter than the prescribed length.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> ```
 #code from automix/data/drums.py
 #remove any mixes that are shorter than the requested length
 self.mix_filepaths = [
     fp
     for fp in self.mix_filepaths
     
     # use torchaudio.info to get information about the audio. This is much faster than loading the whole audio.
     if torchaudio.info(fp).num_frames &gt; self.length
 ]
 ```
</pre></div>
</div>
</li>
<li><p>Loudness normalise the stems and the mixes after loading.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> ```
 #code from automix/data/drums.py
 y /= y.abs().max().clamp(1e-8) 
 ```
</pre></div>
</div>
</li>
<li><p>Look out for silence in the loaded audio: Common practice is to generate a random starting index for the frame from which the audio is loaded. However, it is likely that some of the multitrack stem or the mix as a whole could have just silence in this chunk of loaded audio. This results in generation of NaN in the audio tensor when it is normalised. In the below shown code block, we show how to check for silence. We keep generating a new starting index(<code class="docutils literal notranslate"><span class="pre">offset</span></code>)) for loading the audio until the audio has some content and is not just silence(<code class="docutils literal notranslate"><span class="pre">silent</span> <span class="pre">is</span> <span class="pre">False</span></code>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>         ```
         #code from automix/data/drums.py
         # load the chunk of the mix
                 silent = True
                 while silent:
                 # get random offset
                 offset = np.random.randint(0, md.num_frames - self.length - 1)

                 y, sr = torchaudio.load(
                         mix_filepath,
                         frame_offset=offset,
                         num_frames=self.length,
                 )
                 energy = (y**2).mean()
                 if energy &gt; 1e-8:
                         silent = False

                 # only normalise the audio that are not silent
                 y /= y.abs().max().clamp(1e-8)  # peak normalize
         ```
</pre></div>
</div>
</li>
</ol>
</section>
<section id="enst-drums">
<h2>ENST Drums<a class="headerlink" href="#enst-drums" title="Permalink to this headline">#</a></h2>
<p>Below described is the folder structure of the ENST Drums dataset:</p>
<ul class="simple">
<li><p>ENST-Drums</p>
<ul>
<li><p>drummer_1</p>
<ul>
<li><p>annotation</p></li>
<li><p>audio</p>
<ul>
<li><p>accompaniment</p></li>
<li><p>dry mix</p></li>
<li><p>hi-hat</p></li>
<li><p>kick</p></li>
<li><p>overhead L</p></li>
<li><p>overhead R</p></li>
<li><p>snare</p></li>
<li><p>tom 1</p></li>
<li><p>tom 2</p></li>
<li><p>wet mix</p></li>
</ul>
</li>
</ul>
</li>
<li><p>drummer_2</p>
<ul>
<li><p>(same structure as drummer_1)</p></li>
</ul>
</li>
<li><p>drummer_3</p>
<ul>
<li><p>(same structure as drummer_1)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>We are going to use audios from the wet mix folder for this tutorial.</p>
<p>In the automix/data/drums, we define an ENSTDrumsdataset class and use the <code class="docutils literal notranslate"><span class="pre">getitem()</span></code> to load data for the dataloader in our training loop.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ENSTDrumsDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">drummers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">track_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;kick&quot;</span><span class="p">,</span>
            <span class="s2">&quot;snare&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hi-hat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;overhead_L&quot;</span><span class="p">,</span>
            <span class="s2">&quot;overhead_R&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tom_1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tom_2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tom_3&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">wet_mix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_examples_per_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>
</div>
<ul class="simple">
<li><p>We use indices to define the train-test split.</p></li>
</ul>
<ul>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">getitem()</span></code> of the dataset class, we first generate a <code class="docutils literal notranslate"><span class="pre">mix_idx</span></code> which is a random number in the range of 0 and the number of songs in the directory(len of mix_filepaths). This allows to randomly pick a mix/song from the mix_filepath.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="c1"># select a mix at random</span>
        <span class="n">mix_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mix_filepaths</span><span class="p">))</span>
        <span class="n">mix_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mix_filepaths</span><span class="p">[</span><span class="n">mix_idx</span><span class="p">]</span>
        <span class="n">example_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mix_filepath</span><span class="p">)</span>
        <span class="n">drummer_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">mix_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

        <span class="n">md</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mix_filepath</span><span class="p">)</span>  <span class="c1"># check length</span>
</pre></div>
</div>
</li>
<li><p>Next, we load the mix(<code class="docutils literal notranslate"><span class="pre">y</span></code>) from the filepath. Make sure to check for silence as discussed above. Once the mix is loaded, peak normalise it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># load the chunk of the mix</span>
        <span class="n">silent</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">silent</span><span class="p">:</span>
            <span class="c1"># get random offset</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">y</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">mix_filepath</span><span class="p">,</span>
                <span class="n">frame_offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                <span class="n">num_frames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">energy</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">y</span> <span class="o">/=</span> <span class="n">y</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span>  <span class="c1"># peak normalize</span>
</pre></div>
</div>
</li>
<li><p>Last step is to load the stems. <code class="docutils literal notranslate"><span class="pre">max_num_tracks</span></code> is the maximum number of tracks you want to load. Some songs might have less or more stems than this number. We keep a track of empty stems using <code class="docutils literal notranslate"><span class="pre">pad</span></code> which is <code class="docutils literal notranslate"><span class="pre">True</span></code> whenever the stem is empty.
The <code class="docutils literal notranslate"><span class="pre">getitem()</span></code> returns stems tensor (<code class="docutils literal notranslate"><span class="pre">x</span></code>), mix (<code class="docutils literal notranslate"><span class="pre">y</span></code>), and <code class="docutils literal notranslate"><span class="pre">pad</span></code> information.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  # -------------------- load the tracks from disk --------------------
  x = torch.zeros((self.max_num_tracks, self.length))
  pad = [True] * self.max_num_tracks  # note which tracks are empty

  for tidx, track_name in enumerate(self.track_names):
      track_filepath = os.path.join(
          self.root_dir,
          drummer_id,
          &quot;audio&quot;,
          track_name,
          example_id,
      )
      if os.path.isfile(track_filepath):
          x_s, sr = torchaudio.load(
              track_filepath,
              frame_offset=offset,
              num_frames=self.length,
          )
          x_s /= x_s.abs().max().clamp(1e-6)
          x_s *= 10 ** (-12 / 20.0)
          x[tidx, :] = x_s
          pad[tidx] = False

  return x, y, pad
</pre></div>
</div>
</li>
</ul>
</section>
<section id="dsd100-dataset">
<h2>DSD100 dataset<a class="headerlink" href="#dsd100-dataset" title="Permalink to this headline">#</a></h2>
<p>Below described is the folder structure of the DSD100 dataset:</p>
<ul class="simple">
<li><p>ENST Drums</p>
<ul>
<li><p>Train</p>
<ul>
<li><p>Songdir(songname)</p>
<ul>
<li><p>vocals.wav</p></li>
<li><p>bass.wav</p></li>
<li><p>drums.wav</p></li>
<li><p>other.wav</p></li>
<li><p>accompaniment.wav</p></li>
<li><p>mixture.wav</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Test</p>
<ul>
<li><p>Songdir(songname)</p>
<ul>
<li><p>vocals.wav</p></li>
<li><p>bass.wav</p></li>
<li><p>drums.wav</p></li>
<li><p>other.wav</p></li>
<li><p>accompaniment.wav</p></li>
<li><p>mixture.wav</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Note: Accompaniment is the sum of bass, drums, and other.</p>
<p>For the purpose of training our models, we use:</p>
<p><strong>Input</strong>: vocals, bass, drums, and other</p>
<p><strong>Output</strong>: Mixture</p>
<p>We will first define a dataset class and use the <code class="docutils literal notranslate"><span class="pre">getitem()</span></code> function to load items into the dataloader.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Code from automix/data/dsd100.py</span>

<span class="k">class</span> <span class="nc">DSD100Dataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">track_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bass&quot;</span><span class="p">,</span> <span class="s2">&quot;drums&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="s2">&quot;vocals&quot;</span><span class="p">],</span>
        <span class="n">num_examples_per_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>
</div>
<p>Hereafter, we follow similar structure in <code class="docutils literal notranslate"><span class="pre">getitem()</span></code> as in the case of ENSTDrums.</p>
<ul class="simple">
<li><p>We first pick a mix_filepath on random and then look for non-silent part to load the mix(<code class="docutils literal notranslate"><span class="pre">y</span></code>).</p></li>
<li><p>Then, we load stems(<code class="docutils literal notranslate"><span class="pre">x</span></code>) starting with the same start_idx of the prescribed length.</p></li>
<li><p>We peak normalise all the loaded stems and mix and save the empty stem inofrmation in the <code class="docutils literal notranslate"><span class="pre">pad</span></code> variable.</p></li>
<li><p>We then return <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">pad</span></code>.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="medleydb-dataset">
<h1>MedleyDB Dataset<a class="headerlink" href="#medleydb-dataset" title="Permalink to this headline">#</a></h1>
<p>Described below is the folder structure for MedleyDB:</p>
<ul class="simple">
<li><p>MedleyDB</p>
<ul>
<li><p>songnames</p>
<ul>
<li><p>songname_MIX.wav</p></li>
<li><p>songname_STEMS</p>
<ul>
<li><p>songname_STEMS_{stem_number}.wav</p></li>
</ul>
</li>
<li><p>songname_RAW</p>
<ul>
<li><p>songname_STEMS_{stem_number}_{track_number}.wav</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>STEMS folder have some of the RAW audio tracks combined into a single audio file.</p></li>
<li><p>RAW folder contains all of the audio tracks individually.</p></li>
</ul>
<p>We define the corresponding dataset class like before.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MedleyDBDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root_dirs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="n">max_num_tracks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
        <span class="n">num_examples_per_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">buffer_size_gb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">buffer_reload_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">normalization</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;peak&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">indices</span></code> define the train-test split.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_size_gb</span></code> specifies the amount of data loaded onto RAM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_reload_rate</span></code> specifies the rate of loading new data onto the RAM.</p></li>
</ul>
<p>In case of large datasets like MedleyDB which have large number of stems in the songs, it could be very time-consuming to always load audio tracks from the disk. However, we could load a small subset of the dataset randomly onto the RAM every few iterations to speed up the process.</p>
<p>We load <code class="docutils literal notranslate"><span class="pre">nbytes_loaded</span></code> amount of data onto the RAM everytime the <code class="docutils literal notranslate"><span class="pre">items_since_load</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">buffer_reload_rate</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#code from automix/data/medleydb.py</span>

<span class="k">def</span> <span class="nf">reload_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">examples</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># clear buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items_since_load</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reset iteration counter</span>
        <span class="n">nbytes_loaded</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># counter for data in RAM</span>

        <span class="c1"># different subset in each</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mix_dirs</span><span class="p">)</span>

        <span class="c1"># load files into RAM</span>
        <span class="k">for</span> <span class="n">mix_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mix_dirs</span><span class="p">:</span>
            <span class="n">mix_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mix_dir</span><span class="p">)</span>
            <span class="n">mix_filepath</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mix_dir</span><span class="p">,</span> <span class="s2">&quot;*.wav&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># now check the length of the mix</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">mix_filepath</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">mix_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">mix_num_frames</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nbytes</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">element_size</span><span class="p">()</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">nelement</span><span class="p">()</span>
            <span class="n">nbytes_loaded</span> <span class="o">+=</span> <span class="n">nbytes</span>

            <span class="c1"># now find all the track filepaths</span>
            <span class="n">track_filepaths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mix_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mix_id</span><span class="si">}</span><span class="s2">_RAW&quot;</span><span class="p">,</span> <span class="s2">&quot;*.wav&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_filepaths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_num_tracks</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># check length of each track</span>
            <span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tidx</span><span class="p">,</span> <span class="n">track_filepath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">track_filepaths</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">track_filepath</span><span class="p">)</span>
                <span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="n">nbytes</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">element_size</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">nelement</span><span class="p">()</span>
                <span class="n">nbytes_loaded</span> <span class="o">+=</span> <span class="n">nbytes</span>

                <span class="n">track_num_frames</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">track_num_frames</span> <span class="o">&lt;</span> <span class="n">mix_num_frames</span><span class="p">:</span>
                    <span class="n">mix_num_frames</span> <span class="o">=</span> <span class="n">track_num_frames</span>

            <span class="c1"># store this example</span>
            <span class="n">example</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;mix_id&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mix_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;mix_filepath&quot;</span><span class="p">:</span> <span class="n">mix_filepath</span><span class="p">,</span>
                <span class="s2">&quot;mix_audio&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                <span class="s2">&quot;num_frames&quot;</span><span class="p">:</span> <span class="n">mix_num_frames</span><span class="p">,</span>
                <span class="s2">&quot;track_filepaths&quot;</span><span class="p">:</span> <span class="n">track_filepaths</span><span class="p">,</span>
                <span class="s2">&quot;track_audio&quot;</span><span class="p">:</span> <span class="n">tracks</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

            <span class="c1"># check the size of loaded data</span>
            <span class="k">if</span> <span class="n">nbytes_loaded</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size_gb</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">:</span>
                <span class="k">break</span>
</pre></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./part_3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01_inference.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Inference</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_models.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Models</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Christian Steinmetz, Soumya Sai Vanka, Marco Martnez, Gary Bromham<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>